{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Template for RealTalkTech app infrastructure including VPC, Subnets, DB Subnet Group, Security Group, RDS MySQL Instance, and Internet Gateway.",
    "Resources": {
        "RealTalkTechVPC": {
            "Type": "AWS::EC2::VPC",
            "Properties": {
                "CidrBlock": "10.0.0.0/16",
                "EnableDnsHostnames": true,
                "EnableDnsSupport": true
            }
        },
        "PublicSubnet1": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": {"Ref": "RealTalkTechVPC"},
                "CidrBlock": "10.0.1.0/24",
                "AvailabilityZone": "us-east-1a"
            }
        },
        "PublicSubnet2": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": {"Ref": "RealTalkTechVPC"},
                "CidrBlock": "10.0.2.0/24",
                "AvailabilityZone": "us-east-1b"
            }
        },
        "InternetGateway": {
            "Type": "AWS::EC2::InternetGateway"
        },
        "AttachGateway": {
            "Type": "AWS::EC2::VPCGatewayAttachment",
            "Properties": {
                "VpcId": {"Ref": "RealTalkTechVPC"},
                "InternetGatewayId": {"Ref": "InternetGateway"}
            }
        },
        "PublicRouteTable": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "VpcId": {"Ref": "RealTalkTechVPC"}
            }
        },
        "PublicRoute": {
            "Type": "AWS::EC2::Route",
            "DependsOn": "AttachGateway",
            "Properties": {
                "RouteTableId": {"Ref": "PublicRouteTable"},
                "DestinationCidrBlock": "0.0.0.0/0",
                "GatewayId": {"Ref": "InternetGateway"}
            }
        },
        "SubnetRouteTableAssociation1": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "SubnetId": {"Ref": "PublicSubnet1"},
                "RouteTableId": {"Ref": "PublicRouteTable"}
            }
        },
        "SubnetRouteTableAssociation2": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "SubnetId": {"Ref": "PublicSubnet2"},
                "RouteTableId": {"Ref": "PublicRouteTable"}
            }
        },
        "DBSubnetGroup": {
            "Type": "AWS::RDS::DBSubnetGroup",
            "Properties": {
                "DBSubnetGroupDescription": "Subnet group for RealTalkTech RDS",
                "SubnetIds": [{"Ref": "PublicSubnet1"}, {"Ref": "PublicSubnet2"}]
            }
        },
        "RDSSecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
                "GroupDescription": "Security Group for RealTalkTech RDS instance",
                "VpcId": {"Ref": "RealTalkTechVPC"},
                "SecurityGroupIngress": [{
                    "IpProtocol": "tcp",
                    "FromPort": "3306",
                    "ToPort": "3306",
                    "CidrIp": "0.0.0.0/0" 
                }]
            }
        },
        "RealTalkTechDBInstance": {
            "Type": "AWS::RDS::DBInstance",
            "Properties": {
                "AllocatedStorage": "20",
                "DBInstanceClass": "db.m5.large",
                "Engine": "MySQL",
                "EngineVersion": "8.0",
                "MasterUsername": "admin",
                "MasterUserPassword": "pRreoAalcTtailfky!",
                "DBName": "RealTalkTechDB",
                "BackupRetentionPeriod": 7,
                "DBSubnetGroupName": {"Ref": "DBSubnetGroup"},
                "VPCSecurityGroups": [{"Ref": "RDSSecurityGroup"}],
                "MultiAZ": true
            }
        }
    },
    "Outputs": {
        "DBInstanceEndpoint": {
            "Description": "Connection endpoint of the RealTalkTech RDS instance",
            "Value": {"Fn::GetAtt": ["RealTalkTechDBInstance", "Endpoint.Address"]}
        }
    }
}