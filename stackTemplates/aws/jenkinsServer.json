{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "CloudFormation template for Jenkins Server",
    "Resources": {
      "JenkinsSecurityGroup": {
        "Type": "AWS::EC2::SecurityGroup",
        "Properties": {
          "GroupDescription": "Allow SSH and TCP/8080 for Jenkins",
          "SecurityGroupIngress": [
            {
              "IpProtocol": "tcp",
              "FromPort": 22,
              "ToPort": 22,
              "CidrIp": "0.0.0.0/0"
            },
            {
              "IpProtocol": "tcp",
              "FromPort": 8080,
              "ToPort": 8080,
              "CidrIp": "0.0.0.0/0"
            }
          ]
        }
      },
      "JenkinsInstance": {
        "Type": "AWS::EC2::Instance",
        "Properties": {
          "InstanceType": "t2.micro",
          "KeyName": "jenkins-admin",
          "ImageId": "ami-0f403e3180720dd7e",
          "SecurityGroups": [
            {
              "Ref": "JenkinsSecurityGroup"
            }
          ],
          "UserData": {
            "Fn::Base64": {
              "Fn::Join": [
                "",
                [
                  "#!/bin/bash\n",
                  "yum update -y\n",
                  "yum install -y java-1.8.0-openjdk-devel\n",
                  "wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo\n",
                  "rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key\n",
                  "yum install -y jenkins\n",
                  "systemctl start jenkins\n",
                  "systemctl enable jenkins\n"
                ]
              ]
            }
          }
        }
      }
    },
    "Outputs": {
      "JenkinsURL": {
        "Description": "URL for newly created Jenkins instance",
        "Value": {
          "Fn::Join": [
            "",
            [
              "http://",
              {
                "Fn::GetAtt": [
                  "JenkinsInstance",
                  "PublicDnsName"
                ]
              },
              ":8080"
            ]
          ]
        }
      }
    }
  }
  